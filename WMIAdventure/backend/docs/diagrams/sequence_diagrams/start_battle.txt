title Start Battle

activate Empty

# Battle start call

Empty->Battle: start()

activate Battle

# Setup battle

activate Battle

Battle->Battle: set_up_battle()

## Record initial battle state

activate ProcessRecorder

Battle->ProcessRecorder: record_turn(attacker: Player, defender: Player)

deactivate ProcessRecorder

deactivate Battle

# Perform battle simulation

loop while not is_finished()

activate Battle

Battle->Battle: turn()

## Call coordinator to coordinate next turn

activate Coordinator

Battle->Coordinator: next_turn()

### Get next Player from TurnsQueue

activate TurnsQueue

Coordinator->TurnsQueue: turn()

Coordinator<--TurnsQueue: current_player: Player

deactivate TurnsQueue

### Get opponent

activate Coordinator

Coordinator->Coordinator: get_players_opponent(current_player)

Coordinator<--Coordinator: opponent: Player

deactivate Coordinator

### Call Player to use card

activate current_player - Player

Coordinator->current_player - Player: use_card()

ref over current_player - Player: UseCard

Coordinator<--current_player - Player: used_effects: Effect[*]

deactivate current_player - Player

### Activate used card's effects

loop for effect in used_effects

activate Effect

Coordinator->Effect: activate(current_player, opponent, turnsQueue)

ref over Effect: Activate Effect

deactivate Effect

deactivate Coordinator

end

## Call ProcessRecorder to record this turn

activate ProcessRecorder

Battle->ProcessRecorder: record_turn(attacker, defender)

deactivate ProcessRecorder

end


deactivate Battle
